import torch
import torchvision
import torchvision.transforms as transforms
import numpy as np
import os
from PIL import Image
from collections import Counter

# __imagenet_stats = {'mean': [0.485, 0.456, 0.406],
#                    'std': [0.229, 0.224, 0.225]}
#
# __tiny_imagenet_stats = {'mean': [0.4802, 0.4481, 0.3975],
#                    'std': [0.2302, 0.2265, 0.2262]}
#
# __imagenet_pca = {
#     'eigval': torch.Tensor([0.2175, 0.0188, 0.0045]),
#     'eigvec': torch.Tensor([
#         [-0.5675,  0.7192,  0.4009],
#         [-0.5808, -0.0045, -0.8140],
#         [-0.5836, -0.6948,  0.4203],
#     ])
# }
#
# __cifar10_stats = {'mean': [0.4914, 0.4822, 0.4465],
#                       'std': [0.2023, 0.1994, 0.2010]}
#
# __cifar100_stats = {'mean': [0.5071, 0.4867, 0.4408],
#                        'std': [0.2675, 0.2565, 0.2761]}



transform_train = transforms.Compose([
            transforms.RandomCrop(32, padding=4),
            transforms.RandomHorizontalFlip(),
            transforms.ToTensor(),
            # transforms.Normalize((0.4914, 0.4822, 0.4465), (0.2023, 0.1994, 0.2010)),
            transforms.Normalize((0.5071, 0.4867, 0.4408), (0.2675, 0.2565, 0.2761)),
        ])

transform_val = transforms.Compose([
            transforms.ToTensor(),
    transforms.Normalize((0.5071, 0.4867, 0.4408), (0.2675, 0.2565, 0.2761)),
    # transforms.Normalize((0.4914, 0.4822, 0.4465), (0.2023, 0.1994, 0.2010)),
])



class IMBALANCECIFAR10(torchvision.datasets.CIFAR10):
    cls_num = 10

    def __init__(self, root, imb_type='step', imb_factor=0.02, rand_number=0, train=True,
                 transform=None, target_transform=None,
                 download=False, val = False):
        super(IMBALANCECIFAR10, self).__init__(root, train, transform, target_transform, download)
        np.random.seed(rand_number)
        img_num_list = self.get_img_num_per_cls(self.cls_num, imb_type, imb_factor)
        self.gen_imbalanced_data(img_num_list, val, imb_factor)

    def get_img_num_per_cls(self, cls_num, imb_type, imb_factor):
        img_max = len(self.data) / cls_num

        img_num_per_cls = []
        if imb_type == 'exp':
            for cls_idx in range(cls_num):
                num = img_max * (imb_factor ** (cls_idx / (cls_num - 1.0)))
                img_num_per_cls.append(int(num))
        elif imb_type == 'step':
            for cls_idx in range(cls_num // 2):
                img_num_per_cls.append(int(img_max))
            for cls_idx in range(cls_num // 2):
                img_num_per_cls.append(int(img_max * imb_factor))
        else:
            img_num_per_cls.extend([int(img_max)] * cls_num)

        return img_num_per_cls

    def gen_imbalanced_data(self, img_num_per_cls, val, imb_factor):
        new_data = []
        new_targets = []
        targets_np = np.array(self.targets, dtype=np.int64)
        classes = np.unique(targets_np)
        # np.random.shuffle(classes)
        self.num_per_cls_dict = dict()
        for the_class, the_img_num in zip(classes, img_num_per_cls):
            self.num_per_cls_dict[the_class] = the_img_num
            idx = np.where(targets_np == the_class)[0]
            np.random.shuffle(idx)
            selec_idx = idx[:the_img_num]
            new_data.append(self.data[selec_idx, ...])
            new_targets.extend([the_class, ] * the_img_num)
        new_data = np.vstack(new_data)

        new_targets[0:25000] =[0]*25000
        new_targets[25000:] = [1]*int(25000*imb_factor)
        print(type(new_data), type(new_targets))
        train_index, val_index = self.train_val_split(imb_factor)
        # print('length of train data : {}, length of val data : {} and length of new_data : {}'.format(len(train_index), len(val_index), len(new_data)))

        if not val:
            self.data = new_data[train_index]
            self.targets = np.array(new_targets)[train_index].tolist()
            print('train self.data:', len(self.data))
        else:
            self.data = new_data[val_index]
            self.targets = np.array(new_targets)[val_index].tolist()
            print('val self.data:', len(self.data))

    def get_cls_num_list(self):
        cls_num_list = []
        for i in range(self.cls_num):
            cls_num_list.append(self.num_per_cls_dict[i])
        return cls_num_list

    def __getitem__(self, index: int):
        """
        Args:
            index (int): Index

        Returns:
            tuple: (image, target) where target is index of the target class.
        """
        img, target = super().__getitem__(index)
        return index, img, target


    # Data Splits
    def train_val_split(self, imb_factor):

        x = list(range(25000))
        y = list(range(25000, 25000 + int(25000 * imb_factor)))
        neg_val_index = [21213, 14463, 23845, 14944, 2689, 17624, 14107, 1405, 1080, 14571, 4736, 5306, 5868, 19834,
                         24703, 2227, 6772, 10587, 17733, 8773, 20457, 18566, 15481, 7499, 21949, 5058, 22630, 6100,
                         6736, 21827, 16088, 4477, 17764, 19173, 16863, 23057, 18482, 15327, 16082, 15862, 12906, 1929,
                         6506, 10115, 17442, 4997, 7181, 14347, 12015, 17355, 23572, 16726, 24332, 23843, 13433, 294,
                         11934, 2301, 13822, 12883, 23335, 21670, 5018, 4847, 2212, 4484, 24912, 21024, 578, 11709,
                         24488, 16212, 980, 18485, 21198, 17718, 123, 11490, 5777, 24968, 18821, 4058, 17112, 14801,
                         15763, 3525, 8457, 15070, 10125, 3534, 4588, 5767, 17926, 3946, 3442, 14125, 9635, 20801,
                         13138, 2328, 15619, 4328, 20052, 873, 13204, 23368, 2857, 22528, 1165, 5524, 23547, 13178,
                         4546, 24799, 6675, 23945, 10981, 19914, 2506, 1275, 6211, 11482, 16066, 6018, 15219, 4478,
                         24672, 7007, 9295, 14118, 19998, 12858, 21751, 3593, 11944, 15714, 3321, 2859, 921, 18916,
                         2225, 4068, 4451, 22481, 1597, 2889, 3191, 16380, 10762, 20742, 12539, 10541, 13025, 21265,
                         6147, 10798, 21911, 10602, 8111, 8241, 14482, 3395, 4356, 23442, 11376, 21676, 14211, 16183,
                         14630, 796, 8896, 23784, 441, 2467, 18443, 17087, 12717, 5721, 9673, 19487, 21891, 19068,
                         16444, 22367, 10561, 24913, 20760, 2491, 7494, 23918, 11638, 8329, 10710, 4063, 5033, 12109,
                         22786, 222, 9477, 24546, 6523, 10887, 9850, 3420, 20551, 19793, 9000, 383, 23708, 18533, 2529,
                         17125, 14587, 15813, 10715, 18008, 7356, 18605, 19001, 2235, 11715, 1569, 23519, 19482, 8727,
                         11171, 16499, 17939, 13740, 15377, 8706, 10879, 16811, 17820, 10085, 11054, 20270, 2627, 13478,
                         20979, 9264, 18557, 9525, 23895, 18135, 1188, 18453, 1834, 22416, 21170, 13986, 6123, 19709,
                         8364, 16994, 21015, 3746, 5409, 15425, 10950, 22882, 5449, 16879, 17030, 961, 2968, 13891,
                         7704, 12047, 451, 5171, 14874, 22064, 5202, 2279, 11616, 22618, 18421, 17085, 21417, 13154,
                         540, 13517, 8711, 22137, 22311, 17037, 24379, 24028, 9693, 2693, 13001, 5863, 12388, 23897,
                         21014, 7734, 22916, 24240, 3242, 7314, 8052, 663, 12385, 11182, 6778, 8316, 12568, 10540, 489,
                         16776, 6677, 13035, 627, 16440, 11333, 7618, 14269, 7172, 4412, 15171, 16803, 14025, 22668,
                         1746, 9292, 13171, 20968, 13382, 1499, 5589, 2598, 20005, 8527, 24668, 16387, 6061, 19597,
                         14068, 3908, 22010, 13581, 8380, 9031, 9824, 11713, 3295, 18154, 12868, 14145, 15289, 1546,
                         5239, 14247, 21003, 5652, 11237, 1956, 10411, 7188, 872, 22539, 19972, 3719, 18805, 1119, 8459,
                         24214, 24258, 13296, 17122, 2218, 21838, 21618, 13857, 22803, 13659, 1702, 24882, 17135, 15543,
                         12716, 3572, 24748, 18344, 4037, 828, 11737, 17231, 5007, 5632, 23994, 17653, 9652, 23325,
                         3780, 20958, 3690, 1560, 14742, 18054, 10127, 14259, 22544, 9362, 2709, 11205, 13158, 13604,
                         11884, 21337, 8632, 14945, 9507, 11297, 10815, 15351, 12028, 18445, 14218, 6257, 925, 3166,
                         1897, 21376, 212, 1675, 2267, 20037, 16735, 7528, 12584, 13222, 274, 2745, 14553, 22833, 9437,
                         21632, 6089, 1318, 5441, 2349, 21508, 1763, 20064, 24178, 7959, 9271, 18543, 20317, 14999,
                         4826, 13837, 21534, 13498, 10663, 15111, 19920, 24126, 551, 8349, 14624, 15692, 11288, 19830,
                         552, 21136, 22458, 8184, 1685, 14077, 5046, 21954, 8385, 18446, 8775, 15096, 5484, 14865, 7769,
                         24752, 20101, 14028, 2403, 3716, 20124, 11825, 14556, 19400, 9565, 2722, 2569, 368, 7487, 9793,
                         12478, 6010, 2567, 19, 20309, 12864, 23848, 21870, 11492, 19286, 11531, 5497, 22926, 2861,
                         6554, 23571, 17840, 10218, 21877, 3428, 15294, 6833, 21496, 10311, 5698, 17987, 12246, 14005,
                         3970, 20151, 5057, 17289, 19611, 16682, 18936, 4434, 11898, 11475, 10372, 19867, 17720, 13225,
                         12133, 2752, 5078, 7397, 15404, 3150, 9709, 22181, 295, 9981, 23063, 24815, 5625, 2725, 24702,
                         23967, 18846, 7722, 9944, 2622, 12669, 14626, 8799, 19168, 16568, 2323, 13587, 1879, 11488,
                         3874, 21861, 20649, 9503, 22346, 10698, 4877, 8424, 7536, 9584, 23699, 18789, 22006, 18820,
                         9305, 12035, 16290, 22608, 19599, 2714, 20020, 22688, 22880, 3464, 24727, 2332, 23374, 18273,
                         13876, 1500, 14639, 10491, 17437, 22384, 23751, 22958, 13860, 20907, 23054, 15762, 10721, 4466,
                         17675, 24826, 9066, 7113, 1677, 14109, 6845, 1037, 15880, 9882, 15680, 10207, 3678, 16256,
                         19303, 18165, 16329, 4072, 4036, 15909, 13941, 3726, 9684, 20647, 15659, 781, 24345, 20785,
                         18278, 22401, 10799, 14635, 4617, 21652, 7237, 10650, 23405, 21809, 20618, 12436, 10862, 17911,
                         23801, 494, 16427, 18400, 23371, 270, 12369, 10469, 18607, 7399, 18632, 19384, 14007, 10101,
                         3995, 7918, 8231, 20631, 307, 7874, 20088, 20787, 20452, 17215, 9531, 22784, 4300, 8410, 13370,
                         16840, 6455, 22447, 3813, 1900, 3704, 11994, 3061, 9809, 14090, 18502, 20666, 15609, 13698,
                         17713, 14207, 16999, 16579, 7416, 9806, 2141, 633, 9528, 18257, 12781, 19997, 20864, 3812,
                         11139, 12707, 2823, 13569, 18700, 15941, 14910, 23878, 13800, 17810, 24674, 22809, 301, 17273,
                         11831, 17072, 12337, 14732, 17791, 7694, 17839, 19413, 5955, 4213, 12295, 265, 15959, 13325,
                         22890, 16582, 1489, 21553, 10513, 4457, 3945, 12757, 16000, 6487, 19145, 2366, 2250, 1608, 661,
                         19399, 5690, 1983, 11696, 20868, 2383, 1796, 10539, 24903, 19220, 7290, 2955, 7888, 17022,
                         14837, 1334, 10757, 5147, 10275, 3003, 7651, 6175, 3859, 5577, 12996, 21308, 14552, 12181,
                         21464, 3576, 16225, 7774, 2308, 19906, 24256, 9659, 280, 4816, 4685, 38, 17530, 18989, 17421,
                         5772, 17237, 19278, 10907, 7257, 2794, 14346, 4724, 13464, 9510, 9459, 19751, 4835, 12668,
                         17036, 24943, 17063, 12039, 11566, 17367, 19886, 7673, 20447, 13114, 16976, 9077, 1804, 3415,
                         20482, 4330, 5062, 18196, 8536, 16327, 13291, 15669, 2476, 2915, 13000, 23143, 9682, 11938,
                         180, 7636, 4907, 19999, 18162, 18182, 17485, 12676, 15246, 16882, 10811, 14254, 10874, 17726,
                         20041, 1353, 19006, 7793, 3518, 15654, 1414, 10505, 24698, 9081, 9221, 8107, 13883, 11094,
                         23785, 15822, 14175, 13010, 19962, 8793, 11461, 23814, 15561, 24120, 9022, 443, 23350, 2664,
                         21525, 24244, 4257, 10916, 2186, 16122, 2732, 13018, 23694, 2878, 8704, 16746, 12979, 20798,
                         22501, 16142, 18934, 15821, 4692, 19869, 6435, 11308, 14103, 5518, 14208, 20143, 17050, 11300,
                         4537, 11290, 24683, 487, 21375, 14810, 19350, 10806, 20736, 24549, 24095, 3040, 11677, 24775,
                         1409, 4906, 9648, 16182, 16941, 548, 12680, 21918, 12797, 21012, 10480, 1864, 5689, 2652, 7691,
                         14505, 1976, 310, 7013, 6206, 17742, 1760, 13313, 18192, 20826, 6082, 23852, 5336, 23719, 1239,
                         9121, 6658, 7019, 9160, 1327, 23633, 14681, 3819, 16094, 12682, 11483, 5943, 23658, 23649, 747,
                         8430, 13366, 5304, 2958, 3162, 3741, 6831, 9136, 679, 16944, 16770, 19098, 371, 5481, 19982,
                         9676, 14878, 19040, 1085, 14802, 21643, 2851, 23574, 1783, 19526, 8858, 12912, 15145, 6484,
                         24174, 4469, 4757, 18643, 10998, 13642, 3333, 24904, 11538, 16683, 17494, 14543, 2069, 3796,
                         5264, 21450, 22494, 21888, 4499, 7616, 3580, 14091, 23485, 7958, 12268, 17693, 17246, 5750,
                         21762, 20290, 12164, 14828, 12454, 9304, 19800, 14870, 22930, 22861, 9139, 6606, 19525, 4306,
                         8501, 136, 14036, 10109, 18464, 7479, 4251, 7809, 838, 22124, 16513, 12826, 7561, 23505, 23806,
                         5778, 20822, 14362, 9450, 19199, 2886, 768, 19877, 11028, 20000, 9971, 9831, 7321, 14984,
                         20858, 20369, 597, 2655, 11034, 2255, 17168, 7256, 5924, 12499, 10447, 24494, 20080, 13535,
                         22513, 23677, 17613, 20514, 17248, 14968, 12763, 5118, 9675, 19043, 20684, 160, 8600, 20072,
                         6415, 22713, 17838, 2191, 21270, 16587, 4455, 17573, 12784, 13861, 22869, 23628, 23454, 5925,
                         12334, 19853, 1594, 5946, 10708, 20187, 18742, 3143, 22103, 12522, 23598, 9497, 24122, 10033,
                         24902, 12683, 11817, 13978, 23116, 11858, 4891, 9003, 7560, 8900, 1634, 3140, 8644, 16917,
                         24044, 15061, 23742, 2884, 19769, 20013, 12945, 23062, 1894, 8041, 19836, 22981, 17401, 17795,
                         11002, 8664, 24657, 4493, 18023, 23959, 8236, 11802, 444, 24490, 10897, 6260, 11132, 16360,
                         24280, 24837, 10985, 7988, 11158, 9597, 9953, 22756, 158, 5931, 22680, 2245, 4467, 2247, 13667,
                         2843, 24331, 10972, 583, 10571, 4773, 7749, 13873, 8875, 14486, 11891, 21956, 23697, 6192,
                         5349, 9132, 20856, 14469, 14775, 19519, 17641, 23577, 15184, 22708, 13147, 5159, 9017, 7583,
                         21740, 3481, 23990, 24368, 4456, 18736, 1008, 12701, 15944, 19747, 23379, 2240, 12141, 1002,
                         22258, 8161, 20904, 23769, 21224, 16149, 13966, 4549, 20573, 14749, 12767, 10448, 16868, 2995,
                         24687, 997, 18513, 15236, 13490, 5020, 19775, 3639, 3587, 20536, 3274, 16968, 14444, 19658,
                         7656, 23120, 9328, 21994, 1978, 15794, 14061, 8619, 24232, 5870, 20955, 10253, 10695, 19221,
                         18642, 18025, 24117, 9088, 11265, 4425, 1052, 12887, 23973, 2766, 15656, 16939, 9246, 14663,
                         6060, 3279, 14129, 16320, 12403, 6174, 24356, 11152, 17160, 4220, 22402, 23079, 9352, 14414,
                         9724, 16912, 508, 8035, 10769, 21560, 6161, 20816, 14540, 13056, 16430, 22097, 14012, 21322,
                         12467, 9726, 6485, 15371, 23146, 20335, 11211, 8432, 22033, 22507, 2785, 7292, 22963, 7757,
                         20126, 401, 13492, 2885, 3740, 8066, 13152, 7052, 7480, 23624, 2099, 1704, 1392, 12741, 21130,
                         18401, 22548, 20871, 14631, 22818, 15915, 21396, 10424, 14141, 7946, 19062, 21665, 22245,
                         12405, 8238, 2775, 10982, 24326, 20278, 22428, 16424, 19172, 8383, 3565, 15956, 18127, 36,
                         17956, 5109, 13440, 24722, 19825, 23924, 8787, 10552, 1867, 9644, 18481, 3709, 10584, 21118,
                         22225, 22333, 11561, 12182, 14345, 17358, 22876, 9338, 11486, 5957, 1045, 2110, 8575, 6185,
                         20569, 5357, 7167, 22389, 17188, 3654, 23554, 19921, 13161, 9491, 17781, 12393, 16455, 13180,
                         20947, 6819, 23520, 8744, 10040, 1340, 9055, 13794, 1184, 20597, 10623, 5536, 17096, 3604,
                         4578, 1010, 18384, 10348, 13965, 10246, 12132, 21806, 20067, 13727, 17435, 387, 15785, 5647,
                         4510, 18268, 7289, 1833, 14198, 6416, 17723, 24533, 21075, 8837, 20561, 1794, 14363, 23408,
                         23864, 2231, 5080, 1536, 1928, 12050, 14933, 18998, 6757, 22712, 8273, 8334, 15716, 1265, 3933,
                         24563, 20695, 19294, 20829, 14617, 20123, 8068, 18094, 16422, 23910, 24465, 13954, 1821, 2597,
                         8801, 15382, 12770, 1070, 2224, 21682, 6872, 16135, 12544, 8915, 3410, 19305, 22799, 23319,
                         22765, 11827, 15877, 17913, 20096, 16865, 6682, 14295, 10243, 19986, 245, 21970, 12322, 9406,
                         11109, 9552, 5312, 19152, 2907, 13933, 19653, 14339, 18743, 9300, 22646, 10899, 7493, 24014,
                         18352, 14009, 4088, 3952, 5155, 13389, 2044, 9413, 11509, 17754, 6442, 9807, 7302, 19695,
                         24121, 21237, 19087, 16335, 4382, 5528, 6413, 2108, 18723, 18773, 20782, 3966, 24538, 2090,
                         17849, 525, 2449, 14806, 8211, 14709, 1053, 19727, 20608, 19958, 24873, 8482, 10607, 22391,
                         6864, 7827, 20960, 16862, 21421, 9561, 17748, 13589, 21944, 19300, 12662, 14172, 17232, 13421,
                         3679, 3008, 20986, 12491, 12293, 5627, 12276, 14468, 6463, 4704, 19898, 12348, 12727, 23983,
                         24529, 3141, 23595, 5782, 5570, 6239, 15752, 20299, 8581, 11190, 12292, 12558, 24961, 22215,
                         4627, 22162, 9519, 16716, 13078, 22845, 13674, 13214, 5439, 17695, 17480, 9327, 2684, 14135,
                         10314, 17227, 20423, 6182, 19858, 9064, 4696, 1899, 16695, 7224, 18115, 13512, 12774, 19985,
                         14270, 16376, 3246, 16567, 6570, 19104, 9396, 20308, 12115, 5766, 24879, 23559, 14840, 20180,
                         7274, 10285, 24493, 17996, 17803, 14929, 21634, 591, 3895, 3222, 6093, 15168, 4239, 13824,
                         24476, 8919, 1339, 6759, 10431, 14039, 12250, 11960, 7366, 18928, 6466, 12365, 2791, 14827,
                         15053, 22198, 14765, 21435, 7587, 6250, 3569, 7574, 16613, 3826, 6602, 3056, 17003, 18022,
                         15887, 10948, 4528, 4814, 17250, 5235, 12442, 8794, 3721, 23862, 12252, 16488, 12943, 8638,
                         2973, 12020, 23133, 16878, 7668, 23131, 14675, 9270, 665, 8243, 7437, 21171, 5739, 12375,
                         23322, 12492, 17592, 4821, 21547, 21360, 763, 8544, 8982, 22039, 8991, 16247, 20324, 743,
                         18092, 7627, 5391, 3029, 23517, 23722, 21041, 4684, 21320, 13967, 3129, 6821, 8254, 1622,
                         11220, 6287, 5054, 8859, 16510, 22034, 5937, 3633, 18114, 17035, 13946, 13487, 6335, 13618,
                         825, 7934, 15279, 16365, 24654, 13051, 23568, 14, 16364, 21894, 20718, 21084, 15521, 17646,
                         9656, 20511, 7109, 6655, 5310, 2043, 6749, 22488, 1510, 17729, 758, 12821, 19505, 16569, 9432,
                         17049, 4550, 8005, 13499, 2169, 4953, 20437, 21610, 21901, 6614, 17553, 21172, 12617, 4108,
                         19407, 21105, 5889, 13579, 5498, 23842, 3067, 7619, 24478, 12034, 10092, 14989, 21430, 1258,
                         1176, 869, 17971, 15652, 18873, 10058, 19474, 21529, 14328, 22643, 23386, 12742, 15931, 15440,
                         6264, 24819, 3215, 1320, 21968, 24774, 832, 1980, 24264, 3896, 7319, 10387, 22122, 16233, 1359,
                         7457, 24175, 22059, 5002, 984, 12342, 21628, 19621, 19203, 5621, 3344, 15336, 11533, 15340,
                         5094, 15323, 8209, 11257, 23552, 3991, 19073, 24761, 23863, 2193, 20145, 8767, 6035, 4218,
                         15033, 22597, 1690, 18167, 7803, 11654, 977, 15544, 2585, 5216, 8164, 17964, 15946, 22692,
                         16338, 2649, 10136, 10520, 24608, 23636, 21292, 20746, 10399, 22523, 13014, 8473, 17499, 24960,
                         22927, 2, 183, 6843, 10420, 2089, 20556, 11921, 918, 8734, 8956, 8248, 5874, 9889, 21863,
                         24093, 24097, 5656, 908, 6492, 12886, 10412, 18191, 6694, 24519, 399, 17580, 4784, 16572,
                         20646, 12505, 16006, 20734, 2209, 21457, 5989, 17478, 16824, 780, 21107, 9774, 14317, 3318,
                         3783, 14517, 7431, 4190, 7768, 19406, 24699, 24579, 17543, 1105, 10822, 1761, 5694, 11775,
                         6092, 24343, 18310, 13675, 19521, 1850, 3937, 13142, 17220, 21373, 5362, 3685, 16213, 20031,
                         6968, 16995, 20208, 9407, 21306, 24836, 1524, 17456, 1247, 17164, 13089, 9490, 11471, 76,
                         13869, 5701, 21847, 20330, 21977, 6476, 1502, 14479, 6812, 24285, 21392, 1649, 24154, 21813,
                         3676, 24442, 2641, 16795, 17465, 14029, 2373, 9567, 22102, 3011, 30, 16880, 18249, 8102, 23437,
                         14603, 6380, 958, 9649, 23601, 5134, 16821, 8854, 21541, 20095, 7615, 9629, 6921, 2626, 18689,
                         14293, 19423, 5950, 2151, 2441, 17638, 23463, 3413, 6178, 17191, 10567, 14950, 24024, 10707,
                         24440, 16370, 12724, 18866, 14192, 16983, 21200, 17277, 8753, 11328, 10276, 1739, 23002, 7151,
                         18422, 861, 12753, 16781, 1376, 12803, 20819, 8352, 20844, 14643, 15789, 3347, 4914, 9978,
                         1168, 23969, 15913, 16121, 2855, 13718, 18213, 21314, 5079, 13818, 23850, 13554, 3714, 12719,
                         23361, 20138, 17745, 7002, 17780, 10857, 945, 20368, 23710, 13336, 12974, 10459, 7277, 24269,
                         1543, 536, 4145, 16715, 1951, 19394, 6932, 24979, 19476, 12202, 2804, 10930, 13310, 16136,
                         11495, 5523, 24951, 11814, 11586, 20572, 810, 23066, 12807, 1054, 3698, 6166, 5529, 4521, 9369,
                         17738, 24791, 11159, 24357, 10403, 24945, 20872, 14241, 3507, 16336, 11107, 20453, 2199, 6965,
                         21733, 20524, 11618, 3622, 5373, 3641, 9892, 21924, 20585, 2502, 16588, 13877, 22144, 9043,
                         19261, 3731, 17153, 24544, 23227, 23977, 19157, 9950, 1256, 22223, 4302, 1298, 6000, 20792,
                         20710, 24949, 24360, 15783, 16703, 6517, 17193, 6840, 12286, 10321, 515, 9732, 1038, 12721,
                         5049, 8151, 304, 1497, 19714, 10915, 13337, 10405, 18593, 9819, 4417, 15176, 2371, 5238, 17214,
                         23776, 18194, 5231, 2064, 18823, 17585, 7828, 11907, 12415, 16130, 1315, 18795, 12555, 20683,
                         16234, 18185, 20922, 6227, 4656, 9332, 20797, 7444, 6462, 16684, 261, 15694, 24002, 2142, 721,
                         3907, 19837, 14163, 13416, 6318, 22211, 11666, 17252, 24682, 20032, 484, 5935, 10047, 13643,
                         21379, 17892, 2461, 24704, 16661, 6408, 19524, 11272, 24835, 8015, 22315, 16808, 15031, 740,
                         20392, 21439, 17402, 7451, 22788, 14913, 14634, 10466, 5012, 5142, 24321, 13208, 2934, 19548,
                         10523, 23229, 10310, 75, 6665, 23869, 16410, 17924, 8556, 23412, 4157, 22655, 11329, 22698,
                         2046, 16820, 4989, 10269, 8997, 19538, 19460, 6427, 1355, 10941, 2302, 20719, 2831, 20667,
                         5742, 11803, 8114, 4570, 8564, 7105, 18850, 6954, 8637, 6842, 9513, 2707, 20894, 16799, 15623,
                         3476, 2025, 10345, 6031, 10939, 13930, 11102, 2147, 5300, 19002, 1863, 5124, 12459, 17912,
                         4084, 23473, 14770, 14456, 12714, 13079, 12726, 2896, 4253, 8308, 23611, 1554, 5564, 8036,
                         4202, 19742, 1099, 17155, 11577, 15363, 11545, 16630, 23980, 6133, 11748, 22633, 2076, 965,
                         1587, 23803, 17737, 2509, 11657, 10168, 4711, 947, 18922, 7340, 12042, 3091, 3800, 1605, 102,
                         4815, 3751, 20913, 18523, 16696, 13902, 24928, 19195, 24151, 5585, 21300, 12882, 3514, 23048,
                         21986, 6942, 1866, 15924, 5072, 10210, 4955, 1260, 3182, 15013, 11234, 20087, 9604, 12786,
                         21402, 16402, 10766, 251, 8909, 17312, 5265, 895, 3663, 11312, 3085, 2264, 24713, 9384, 1940,
                         11829, 15305, 7563, 3076, 15256, 15087, 12848, 8755, 13515, 2599, 9626, 17953, 13437, 17488,
                         17527, 10022, 5964, 12531, 105, 7147, 16479, 15912, 19673, 20283, 19458, 11786, 16894, 6888,
                         7629, 9714, 19271, 651, 21321, 4051, 21331, 6891, 11161, 11073, 16461, 8551, 15787, 22185,
                         23279, 8576, 7031, 23482, 13469, 11723, 14526, 5713, 715, 1952, 19923, 3522, 17989, 2377,
                         10301, 21401, 9848, 6477, 17025, 15265, 14313, 22365, 15546, 18395, 21971, 18799, 12323, 19639,
                         2495, 20192, 24034, 6194, 2135, 6958, 9666, 2747, 3573, 8635, 19428, 21635, 11887, 9070, 22068,
                         3203, 1853, 22044, 6091, 8517, 8405, 2103, 7853, 13524, 8968, 23534, 20403, 3493, 21046, 380,
                         13137, 8890, 14844, 12598, 24623, 13741, 22161, 12397, 18788, 20906, 18657, 18848, 18051,
                         17651, 9260, 8074, 18245, 5240, 3275, 7490, 19017, 21395, 23922, 7194, 3650, 12228, 19740,
                         8343, 7012, 11668, 17365, 10337, 4922, 4947, 15157, 23157, 1046, 1706, 12465, 14586, 16890,
                         12937, 12183, 2472, 2152, 19773, 4121, 7108, 12139, 4567, 22658, 20865, 23351, 12510, 22078,
                         9190, 15961, 850, 7380, 10792, 2183, 24412, 10169, 3694, 23587, 23888, 20376, 21842, 9589,
                         22023, 19194, 22069, 10538, 13213, 22678, 10557, 17270, 16205, 12176, 2527, 4520, 19027, 11597,
                         18929, 4807, 6903, 11289, 5815, 6680, 23266, 13060, 22693, 20548, 19235, 23976, 5263, 9504,
                         18430, 1791, 3948, 21205, 1167, 21223, 8634, 16409, 2392, 17823, 3253, 19371, 6347, 19942,
                         4775, 24205, 4294, 24816, 1387, 22512, 22582, 22957, 6199, 4928, 8453, 17481, 22878, 1911,
                         13775, 17307, 21122, 20778, 15499, 19077, 12157, 170, 22647, 6309, 9111, 14079, 11313, 2687,
                         17242, 10892, 5678, 23781, 24771, 24785, 5035, 22046, 9994, 24536, 14264, 10313, 8227, 10159,
                         18520, 3276, 16221, 4984, 8415, 20643, 13764, 5592, 1044, 3083, 17642, 19052, 24021, 11222,
                         24625, 22383, 20352, 9193, 8537, 7501, 13759, 19564, 6715, 24817, 9033, 13235, 10995, 3976,
                         19466, 18676, 6045, 24166, 23549, 11138, 20758, 90, 20181, 8764, 14326, 18026, 8508, 24537,
                         10057, 11232, 9378, 10008, 8725, 5507, 10691, 13545, 6125, 13050, 1505, 3727, 5554, 6098,
                         12547, 22960, 10694, 5013, 17751, 6652, 3300, 15874, 9402, 24222, 12900, 20807, 6593, 20166,
                         4733, 1145, 23415, 332, 3809, 223, 11630, 3081, 15032, 10673, 8670, 11442, 14383, 20571, 12258,
                         6306, 2994, 1104, 15235, 4683, 21354, 4720, 3646, 12927, 18658, 3552, 24604, 23484, 23663,
                         24985, 9326, 23284, 22100, 21312, 20338, 7578, 19757, 7459, 13820, 20600, 19587, 23294, 20051,
                         23504, 17083, 1171, 7523, 7677, 21408, 10994, 11007, 15529, 22865, 22008, 13929, 22282, 7488,
                         12343, 19342, 24661, 4804, 9781, 7497, 12005, 8026, 22683, 8244, 11359, 21731, 24000, 2695,
                         12904, 6028, 16388, 4851, 9493, 1079, 14206, 1927, 4608, 15345, 18528, 1292, 15886, 8714,
                         21935, 10241, 8375, 20897, 6962, 19852, 9556, 9029, 21527, 17561, 21586, 6786, 12251, 1386,
                         24049, 18071, 20744, 730, 23389, 4897, 2048, 15768, 22171, 18198, 11640, 15432, 16184, 22323,
                         9697, 12315, 2686, 2944, 7345, 3923, 8294, 6418, 13084, 4150, 24784, 6957, 20134, 5316, 22490,
                         19205, 9638, 23867, 7370, 2298, 1009, 24430, 9919, 12404, 3915, 20795, 19379, 23318, 7879,
                         20456, 315, 13593, 10081, 17311, 15179, 11823, 6436, 9672, 20786, 989, 6376, 9920, 4290, 13236,
                         17302, 8004, 8431, 6708, 11233, 21896, 2657, 23007, 13029, 23501, 15943, 12586, 12341, 21217,
                         20817, 23182, 4025, 20432, 23492, 10002, 4824, 7889, 15038, 15402, 49, 13125, 22899, 5590,
                         9385, 13155, 4514, 12647, 23808, 1735, 20296, 8172, 21301, 15064, 13298, 22538, 3190, 18662,
                         7141, 3447, 17950, 23640, 11570, 2413, 3736, 24719, 14911, 7904, 13383, 12787, 13365, 19711,
                         18169, 12898, 7530, 859, 23805, 6160, 9357, 6527, 6706, 23159, 22943, 23044, 16024, 20366,
                         11772, 9061, 19885, 19720, 11348, 8384, 10277, 139, 852, 6657, 16926, 23252, 3172, 1057, 870,
                         10905, 1274, 678, 14797, 6448, 17505, 3250, 10884, 8803, 12131, 7862, 17189, 9746, 13947,
                         19188, 14779, 2683, 4772, 5130, 298, 16732, 22886, 22032, 11061, 4612, 23849, 10514, 23652,
                         19086, 14019, 20893, 12986, 12731, 22871, 16589, 3360, 5613, 15585, 185, 24560, 10067, 23477,
                         23605, 19414, 8006, 8180, 10938, 19527, 1670, 19897, 13710, 550, 21821, 24545, 24975, 16801,
                         3111, 15494, 11195, 20119, 8013, 15338, 22240, 4407, 20502, 6765, 18715, 22901, 17679, 6790,
                         24425, 16934, 11030, 23508, 10031, 21126, 10558, 11230, 12798, 11989, 22013, 15531, 10598,
                         4791, 2578, 15869, 18378, 1992, 19882, 7781, 8633, 22339, 7040, 3149, 3942, 6272, 15043, 4311,
                         19318, 7906, 4307, 23684, 13686, 4476, 20763, 20026, 8662, 8776, 5933, 22133, 9559, 1220,
                         20723, 8718, 20910, 22922, 4004, 15234, 2097, 16159, 4776, 22504, 14580, 11409, 188, 8198,
                         22457, 22995, 22028, 20316, 19273, 23241, 7845, 20363, 2835, 812, 16368, 8296, 7427, 19030,
                         12264, 14189, 1681, 15101, 12275, 7386, 11714, 12825, 13449, 292, 21564, 6262, 8279, 19383,
                         11219, 10789, 9442, 9109, 845, 2078, 21425, 23914, 13095, 4303, 5541, 23593, 8145, 22816, 6073,
                         2203, 21979, 18222, 12401, 5380, 18345, 11543, 21963, 18768, 589, 18663, 1798, 13530, 20851,
                         4492, 8826, 6176, 15322, 14656, 19966, 6971, 14763, 3086, 4849, 2682, 16323, 16549, 21521,
                         22464, 4274, 21796, 4981, 1755, 22154, 4916, 5017, 16405, 21216, 23052, 9148, 24513, 22761,
                         13897, 2737, 7553, 21072, 15464, 22083, 1211, 7525, 10479, 9517, 17306, 4834, 12696, 21900,
                         13989, 23528, 17194, 16639, 11968, 3540, 7117, 20239, 23375, 8946, 15606, 20743, 23487, 10184,
                         5794, 17297, 18549, 18398, 20874, 24304, 18153, 12642, 15066, 6057, 15228, 1474, 7588, 8128,
                         24621, 6232, 9575, 22043, 7948, 3857, 12995, 21071, 23544, 17292, 9788, 8322, 13720, 8147, 881,
                         21981, 14488, 4216, 3137, 6430, 23540, 18733, 13730, 10906, 8806, 23152, 8686, 4186, 23196,
                         22011, 13328, 338, 2483, 15169, 8989, 10595, 1299, 12105, 14343, 13400, 407, 20670, 11810,
                         13373, 8940, 16051, 13157, 8317, 23632, 12808, 9045, 5139, 18903, 5679, 8595, 6580, 24965,
                         1159, 882, 5157, 23392, 8604, 20387, 16264, 13536, 22677, 5526, 510, 7917, 13425, 18038, 253,
                         10724, 9541, 10118, 482, 2104, 9474, 18828, 8171, 9374, 3478, 14834, 6731, 15243, 17811, 14549,
                         5010, 13836, 14336, 22690, 1801, 22422, 4663, 10103, 55, 24559, 2172, 7645, 17706, 5186, 1959,
                         15581, 16699, 308, 17479, 24685, 9191, 7018, 3441, 889, 2619, 10201, 8656, 19572, 1410, 20103,
                         10864, 7489, 23416, 15558, 1936, 15570, 6214, 7119, 13935, 11568, 21315, 10501, 23214, 23023,
                         5607, 9849, 5068, 23137, 8703, 18889, 15472, 11033, 22151, 2633, 14599, 4110, 21372, 6039,
                         20044, 15107, 11236, 5389, 16007, 9602, 13091, 15125, 16743, 17697, 3330, 21293, 11215, 4266,
                         15712, 22856, 8874, 16535, 15889, 24263, 18759, 16686, 21625, 23686, 21389, 12560, 16202, 764,
                         17688, 8813, 5173, 957, 19010, 8299, 15430, 101, 1116, 854, 3427, 3592, 21353, 16933, 16548,
                         1508, 12722, 11055, 9153, 364, 18616, 9301, 23012, 12062, 11875, 9269, 8818, 17615, 15306,
                         6378, 15122, 15147, 18888, 19296, 3438, 14703, 4288, 7697, 24590, 9344, 17982, 14905, 16279,
                         20362, 19431, 8008, 23277, 20673, 19192, 23896, 9008, 7739, 6662, 19767, 4539, 23427, 21157,
                         12827, 23226, 18692, 13385, 6693, 6265, 14756, 7409, 86, 19343, 2837, 13342, 3662, 3305, 15350,
                         23756, 24432, 2374, 14780, 7968, 3628, 9703, 5560, 24531, 14255, 992, 21097, 11052, 19675,
                         18011, 17123, 13270, 10603, 7455, 24605, 13398, 7025, 18762, 7610, 15879, 2922, 2156, 8897,
                         3346, 5835, 14406, 2828, 23573, 7419, 19500, 15755, 9918, 9297, 4089, 11271, 1030, 3737, 15550,
                         5788, 12509, 5229, 11952, 1541, 7772, 3612, 19310, 10055, 9608, 14310, 14102, 4351, 19083,
                         22272, 21504, 2455, 18396, 19297, 24381, 11136, 2981, 12981, 15650, 21626, 16041, 14839, 513,
                         3109, 4679, 21238, 18612, 12635, 16539, 1656, 9526, 17539, 11975, 17902, 18488, 6933, 14516,
                         6565, 333, 10720, 1487, 18449, 23857, 14509, 1759, 16982, 10341, 1519, 6953, 24521, 13302,
                         20973, 24482, 794, 5254, 5247, 16957, 19327, 15238, 506, 19702, 8510, 7653, 8805, 4179, 24539,
                         8542, 20173, 4191, 4668, 14113, 877, 2723, 12921, 18909, 23329, 18073, 23695, 16103, 21820,
                         1628, 22694, 23099, 2592, 13470, 21318, 18357, 692, 3913, 15538, 17755, 14685, 16485, 7100,
                         7469, 8571, 17217, 5364, 2380, 4018, 13423, 7931, 22009, 17923, 13144, 3505, 10731, 24302,
                         14758, 12713, 10404, 3343, 21100, 16288, 1317, 7492, 1503, 14501, 8210, 277, 21154, 22545,
                         7787, 5671, 20688, 3835, 8275, 22183, 3837, 12587, 1154, 17327, 11544, 13955, 18209, 12281,
                         12750, 5031, 20288, 9020, 21279, 4095, 10947, 17909, 16261, 20759, 15174, 8917, 862, 4694,
                         17405, 17637, 6064, 23303, 8849, 14448, 446, 13919, 4459, 19964, 12022, 14759, 20355, 24769,
                         13259, 620, 6767, 19368, 9351, 9713, 10077, 8295, 7568, 6345, 8908, 1518, 10188, 11724, 3910,
                         18790, 19584, 13798, 24681, 23887, 1584, 14306, 11766, 5574, 10203, 13611, 20883, 6203, 17829,
                         10896, 13431, 21550, 22063, 9115, 8150, 11774, 14520, 12366, 9864, 16924, 1621, 21483, 13544,
                         22707, 9393, 9244, 4169, 23180, 17524, 11242, 18842, 16348, 1590, 8303, 8642, 8769, 5972,
                         18265, 5646, 8702, 17946, 8, 21186, 21240, 1016, 3473, 11140, 10492, 13216, 19020, 1205, 18480,
                         19392, 23032, 10705, 20411, 7313, 18407, 18785, 10943, 13563, 21694, 19107, 13263, 23255,
                         15492, 18113, 22150, 4346, 2423, 16867, 5582, 20803, 23166, 21490, 12896, 4557, 13493, 18343,
                         16848, 4077, 24277, 5406, 19812, 3989, 24073, 18132, 12473, 17406, 17027, 7429, 16248, 10619,
                         16841, 22373, 24453, 24718, 20902, 23378, 20513, 13960, 7044, 24414, 20901, 15938, 23565, 1912,
                         6261, 1402, 9990, 7387, 11791, 20090, 15906, 2260, 23435, 10091, 24759, 14169, 19293, 5634,
                         13427, 15586, 5454, 2830, 23965, 13273, 6219, 21362, 9646, 2030, 15888, 18594, 24210, 9603,
                         13778, 21001, 18779, 6139, 20301, 13991, 9487, 12735, 12136, 7965, 20470, 21416, 11244, 750,
                         9467, 12390, 17806, 17382, 13907, 9375, 1417, 430, 24757, 9720, 16893, 6052, 13169, 19928,
                         19125, 4224, 15973, 7692, 15063, 23858, 12959, 4446, 2375, 19325, 3118, 18483, 20745, 17568,
                         1222, 20773, 17210, 19382, 16355, 2278, 14846, 6381, 19707, 4126, 956, 6827, 12689, 7414,
                         13543, 5534, 8051, 2770, 16680, 24435, 936, 2814, 8222, 16031, 13132, 10524, 1015, 13093,
                         22187, 23072, 18359, 7220, 1108, 5791, 18259, 5558, 4836, 17844, 10580, 21451, 21845, 11872,
                         10814, 19893, 14112, 16935, 19871, 4164, 10402, 16975, 10627, 18455, 7079, 16681, 11425, 15647,
                         23635, 3231, 14637, 11327, 4971, 3969, 16271, 652, 6344, 15580, 6566, 2583, 23882, 13046, 1509,
                         15426, 1051, 3508, 14356, 4750, 13731, 16473, 16996, 20920, 13528, 11314, 13503, 7986, 9742,
                         10430, 15894, 18731, 13033, 10976, 18570, 16884, 15079, 23662, 12149, 3599, 17132, 13739,
                         15917, 5479, 23396, 5075, 11014, 3139, 16046, 6428, 5302, 17663, 3711, 6459, 5255, 2948, 4886,
                         18707, 22279, 3963, 10418, 3591, 5824, 9478, 19287, 5132, 16421, 5493, 12329, 9333, 23564,
                         19307, 7837, 23782, 16886, 10617, 4777, 6383, 8014, 8406, 11259, 22585, 23627, 22111, 4196,
                         6895, 20755, 11494, 10342, 13446, 22126, 8173, 15761, 22862, 3669, 1352, 19595, 2669, 5954,
                         11194, 21128, 531, 12759, 3070, 7201, 3322, 732, 7154, 13387, 8532, 15308, 16546, 21507, 19955,
                         16447, 7685, 3867, 557, 9777, 15876, 3041, 22807, 20029, 16372, 2788, 23989, 14282, 18005,
                         12118, 7829, 20203, 6372, 5740, 14550, 14508, 9371, 13689, 10527, 20770, 17410, 16296, 2471,
                         6707, 13443, 14992, 14219, 1542, 6369, 3026, 18337, 4350, 4644, 20721, 13664, 14726, 15720,
                         7532, 10439, 5696, 17887, 7511, 23955, 4818, 17074, 4595, 20227, 19409, 19916, 2672, 6839,
                         15490, 20637, 16034, 7045, 4321, 12592, 19351, 22562, 20555, 10742, 2681, 24206, 790, 24924,
                         1250, 8533, 8827, 6146, 12854, 23254, 18524, 5218, 24458, 20421, 16111, 13901, 1903, 9515,
                         24587, 12053, 12799, 11270, 12903, 9660, 18282, 4911, 3237, 642, 4728, 14457, 6898, 22615,
                         17687, 5790, 7817, 10973, 17691, 20056, 16120, 23024, 19803, 21289, 15721, 20880, 12284, 4614,
                         8460, 10041, 359, 9530, 22075, 9103, 13206, 2116, 18883, 9535, 13074, 13319, 21802, 20523,
                         5873, 24104, 4365, 7039, 19945, 15039, 10626, 23637, 21497, 11520, 18329, 3693, 15569, 2061,
                         19744, 16063, 14872, 19374, 8116, 2616, 40, 4227, 12004, 21474, 6761, 6426, 7026, 12030, 5991,
                         9488, 21512, 9048, 3890, 4286, 7392, 11368, 15983, 1564, 12304, 14949, 7050, 18091, 11379,
                         6714, 13167, 15089, 14745, 21794, 11038, 12386, 571, 3390, 10187, 18469, 2006, 6811, 4460,
                         6307, 6575, 6019, 22768, 24637, 15864, 849, 22522, 11902, 12331, 19838, 191, 5833, 2935, 1604,
                         9078, 15261, 14197, 3458, 9223, 19075, 20961, 19334, 11699, 4230, 10088, 17020, 16672, 24352,
                         22325, 8387, 23421, 16561, 4263, 564, 7799, 7973, 10263, 19492, 24894, 18564, 19268, 18971,
                         19749, 11437, 12085, 6209, 15282, 12788, 23556, 10202, 4359, 6333, 23019, 6451, 11593, 14095,
                         3268, 12695, 1701, 11596, 2139, 9999, 8505, 21287, 2548, 21203, 23103, 1215, 22747, 7907,
                         17722, 14753, 5061, 8416, 17834, 9404, 6717, 17889, 21328, 15624, 14491, 22917, 8905, 726,
                         8086, 12367, 21250, 4333, 8469, 13842, 10361, 1319, 15139, 24084, 3001, 11332, 11278, 5374,
                         20016, 4743, 10569, 15646, 11084, 12014, 20280, 15092, 24091, 14484, 12287, 2291, 15229, 20474,
                         18049, 3049, 5125, 11427, 21221, 7832, 4819, 12745, 3657, 19939, 13632, 4200, 7281, 8115, 6516,
                         11248, 5489, 565, 22254, 18992, 19177, 21479, 6948, 4078, 353, 488, 6403, 11623, 15722, 22626,
                         19590, 198, 723, 20866, 13053, 24755, 14117, 5878, 20228, 11119, 5898, 1271, 20890, 6202,
                         15416, 23671, 24436, 2414, 10741, 7406, 23265, 24315, 21103, 21648, 9501, 19298, 2629, 6331,
                         17790, 1756, 5352, 6862, 21363, 12493, 18251, 7280, 14815, 24558, 985, 9211, 22755, 19719,
                         16899, 18217, 9704, 22045, 13290, 7067, 41, 7541, 11849, 6149, 6251, 18500, 9585, 3524, 20245,
                         24732, 5221, 10239, 6314, 10070, 23366, 13804, 13556, 9289, 3849, 24072, 19233, 20436, 4254,
                         22018, 23280, 12515, 14529, 20218, 23717, 12159, 11862, 16842, 200, 16851, 24027, 11264, 18830,
                         13210, 1881, 17336, 16442, 89, 24995, 24394, 4686, 19462, 2000, 11624, 5533, 18263, 2800,
                         14380, 19335, 17928, 1208, 24353, 19651, 6163, 16476, 15588, 10452, 23224, 6604, 19357, 2513,
                         138, 6775, 16769, 17862, 12206, 5583, 17567, 12978, 10931, 13408, 898, 7460, 3586, 20161,
                         10771, 14736, 10477, 21867, 12448, 12239, 20927, 7156, 23893, 8265, 18427, 2254, 18813, 1217,
                         11610, 15791, 5146, 13098, 24377, 11208, 3754, 972, 21969, 13987, 4367, 19139, 12381, 12363,
                         9926, 22636, 24294, 10530, 8977, 11363, 22049, 18, 17498, 17268, 2452, 15760, 3645, 7249,
                         19522, 8058, 21818, 4414, 2634, 11686, 11019, 4378, 13695, 13910, 18728, 24973, 840, 21214,
                         9025, 23712, 10859, 5456, 2568, 3692, 19069, 12220, 6235, 3509, 9651, 996, 17804, 17507, 20027,
                         9480, 8931, 21675, 13694, 2541, 8582, 9053, 22863, 16662, 6595, 9034, 1277, 4090, 10318, 10180,
                         9973, 24709, 18141, 22815, 11558, 9817, 17387, 24399, 4993, 22997, 21499, 10042, 3381, 17452,
                         3176, 10444, 10727, 21853, 2136, 11365, 19004, 15077, 6738, 24778, 16439, 8028, 17888, 11380,
                         5119, 1576, 18868, 724, 816, 5091, 8427, 5920, 2586, 14547, 18103, 3862, 17677, 20373, 6946,
                         24424, 16570, 21095, 18995, 5967, 9316, 7355, 6818, 1960, 5019, 10630, 63, 21683, 13514, 5557,
                         10693, 24144, 163, 11198, 9826, 8495, 18540, 4500, 22139, 23846, 19247, 7871, 24127, 21771,
                         19158, 20939, 21543, 22604, 18865, 6945, 11400, 13653, 14761, 2504, 3794, 13758, 13227, 4861,
                         22193, 11167, 23045, 14953, 1979, 273, 7269, 7807, 15895, 24856, 1300, 23618, 6489, 6395,
                         12008, 8692, 12800, 13688, 21767, 6490, 5162, 14881, 17323, 4601, 21220, 4597, 6224, 18706,
                         8880, 8371, 7403, 10747, 17140, 10227, 17082, 3511, 1362, 20329, 13459, 24361, 20035, 24196,
                         8204, 24223, 1289, 8089, 24328, 8652, 5847, 1563, 6909, 14799, 13790, 1404, 11223, 24358,
                         22425, 15123, 16350, 4007, 10932, 1637, 5226, 4124, 20994, 1772, 20209, 4758, 1114, 16307,
                         4687, 22631, 17783, 20384, 4779, 24341, 20788, 19516, 16250, 4319, 18237, 23327, 13015, 9216,
                         6412, 20089, 14969, 7966, 23140, 18861, 11704, 2118, 19309, 22881, 14551, 3195, 13165, 14942,
                         3025, 10378, 15801, 2125, 17873, 23261, 31, 15297, 19634, 11712, 4970, 4133, 1358, 18618,
                         13101, 24134, 17404, 10802, 18582, 20714, 6519, 6164, 21766, 10749, 24908, 9313, 3090, 351,
                         15288, 3601, 4825, 7671, 7413, 24058, 17551, 16412, 24607, 4237, 17236, 20996, 206, 22262,
                         21915, 3715, 5520, 10390, 5260, 13276, 5024, 18148, 14629, 9157, 23373, 5397, 18006, 10107,
                         17489, 6643, 3451, 11369, 20451, 24603, 11384, 9868, 554, 14073, 22775, 2660, 8955, 10312,
                         18377, 5968, 6619, 2305, 19544, 413, 18704, 16622, 22411, 514, 4268, 16831, 15507, 7761, 21248,
                         8555, 5757, 8048, 6346, 11117, 5726, 19164, 12751, 23205, 16792, 23273, 8338, 9618, 22939,
                         15390, 20969, 17084, 22837, 9989, 9388, 3443, 15140, 3096, 3651, 2716, 12776, 7938, 21768,
                         5549, 10634, 13522, 5251, 5746, 7097, 6504, 7543, 23364, 3206, 5695, 8216, 11835, 17660, 19502,
                         17848, 24141, 8306, 10370, 11214, 16484, 5143, 16881, 21226, 16306, 18001, 17969, 15293, 10548,
                         5040, 20104, 7032, 20953, 15272, 3652, 11912, 19918, 6179, 5104, 15809, 12870, 4128, 3409,
                         1870, 11097, 4242, 13104, 9058, 799, 22590, 12335, 18599, 15266, 20428, 6611, 21732, 4774,
                         11980, 3365, 22573, 11325, 13957, 11594, 1367, 1842, 12525, 17886, 21992, 17033, 24612, 13292,
                         15527, 9356, 24948, 17281, 19115, 3024, 10666, 18678, 24236, 11480, 5165, 19037, 12439, 9107,
                         15482, 14150, 1799, 24301, 23413, 11013, 14119, 8779, 15841, 22956, 7951, 14616, 218, 21893,
                         23013, 2017, 3483, 18804, 5572, 4419, 15291, 22259, 4261, 5747, 10608, 22310, 14897, 22601,
                         13781]
        if imb_factor == 0.02:
            pos_val_index = [25273, 25375, 25169, 25433, 25260, 25140, 25446, 25135, 25233, 25380, 25459, 25399, 25125,
                         25283, 25391, 25308, 25189, 25317, 25148, 25496, 25200, 25276, 25296, 25067, 25461, 25094,
                         25173, 25054, 25055, 25010, 25357, 25381, 25383, 25156, 25366, 25343, 25101, 25424, 25150,
                         25307, 25076, 25028, 25334, 25342, 25398, 25415, 25295, 25111, 25466, 25093, 25217, 25099,
                         25390, 25179, 25001, 25032, 25474, 25197, 25147, 25323, 25485, 25404, 25105, 25473, 25498,
                         25185, 25171, 25182, 25329, 25113, 25312, 25340, 25305, 25228, 25102, 25163, 25151, 25281,
                         25298, 25145, 25355, 25059, 25423, 25419, 25053, 25186, 25412, 25368, 25349, 25351, 25049,
                         25254, 25370, 25063, 25253, 25071, 25002, 25223, 25096, 25241]

        elif imb_factor == 0.2:

            pos_val_index = [28265, 26111, 26380, 25713, 26329, 29556, 28543, 25658, 25725, 25121, 29996, 29917, 27708, 26068, 25246, 26344,
            27077, 28079, 29389, 28622, 28596, 27750, 27062, 29548, 29992, 27675, 25184, 29177, 28495, 27619, 27860, 28757,
            29235, 26250, 25285, 29112, 29684, 28723, 27448, 25824, 29298, 25909, 27834, 29995, 29073, 27180, 28695, 27120,
            26211, 29557, 29188, 29151, 26712, 26481, 26562, 28445, 28538, 27774, 25909, 29179, 29868, 28598, 28553, 25546,
            29670, 28978, 29220, 25266, 28191, 27698, 28952, 28146, 27518, 25586, 26011, 28359, 29381, 27716, 25475, 28424,
            29130, 29189, 25341, 29108, 29855, 28241, 25497, 28489, 27055, 26521, 28073, 28131, 26457, 26100, 26090, 27844,
            28618, 28158, 28764, 28531, 28399, 27226, 28986, 26192, 27723, 27425, 29495, 25863, 28530, 27060, 26301, 28337,
            25722, 25282, 29781, 28511, 27393, 27130, 25115, 25912, 27136, 27483, 27862, 27038, 29128, 26547, 25804, 26145,
            27394, 28025, 28565, 28853, 28205, 26975, 26597, 29791, 28805, 26015, 25505, 27621, 29498, 29083, 25185, 25298,
            28625, 28131, 25492, 27811, 26508, 29567, 28858, 28652, 27347, 27996, 25285, 26315, 27164, 25237, 26685, 27164,
            26632, 27662, 29459, 28742, 26591, 27792, 28704, 27336, 25055, 29845, 27362, 26691, 27473, 29049, 26079, 29608,
            28676, 25757, 26365, 29997, 28131, 26353, 27769, 25074, 27292, 25610, 26451, 28128, 25394, 29335, 26449, 26396,
            27409, 26818, 25449, 28014, 28248, 26563, 27643, 25759, 26274, 25715, 26016, 25376, 26933, 29155, 28532, 25978,
            27434, 25592, 27951, 27145, 27979, 29660, 29050, 29894, 28110, 28907, 27617, 27141, 25449, 29754, 27600, 28999,
            29523, 26728, 28308, 25993, 26747, 25942, 25344, 29481, 26460, 25201, 27075, 28321, 27517, 27203, 28584, 27243,
            27849, 26108, 29908, 28457, 25309, 26607, 27666, 25529, 29648, 25626, 27442, 29659, 27167, 26687, 25927, 29411,
            28562, 27141, 29753, 28765, 26116, 25217, 29395, 29307, 27419, 26365, 29575, 27822, 25246, 26885, 27096, 25950,
            28454, 26125, 26404, 29055, 29116, 27008, 28223, 26643, 25279, 28220, 28947, 28600, 29796, 28815, 27392, 28117,
            26926, 28742, 28408, 26643, 29049, 25726, 29290, 25121, 25624, 28804, 25327, 28503, 25843, 28659, 25170, 29288,
            27127, 26698, 27867, 27579, 29871, 26952, 26185, 26108, 28365, 25753, 29169, 27098, 28229, 28738, 28255, 28625,
            26859, 28649, 29384, 28975, 27193, 25853, 26753, 25018, 28715, 26255, 29832, 25797, 28837, 26694, 27621, 28610,
            25414, 29334, 26682, 26672, 29158, 29232, 26841, 29203, 28576, 28970, 25231, 28605, 26029, 27395, 29093, 25722,
            26615, 26198, 29879, 25979, 26245, 27872, 29614, 29852, 29058, 27360, 27788, 25509, 27679, 26605, 26475, 28220,
            27146, 27031, 28085, 28985, 26747, 27492, 29181, 29654, 28895, 28755, 26904, 25607, 26740, 26875, 26979, 26905,
            25523, 26947, 26496, 25986, 25072, 26612, 25298, 28382, 26895, 29189, 28072, 26841, 26876, 27867, 27731, 25112,
            27430, 26419, 29409, 29899, 26203, 25578, 28907, 28385, 29591, 28418, 25619, 28219, 27668, 29705, 26904, 29429,
            29542, 25209, 25419, 25177, 26792, 25338, 29960, 25417, 27057, 26633, 25219, 28848, 25967, 28330, 25966, 28141,
            25586, 25884, 28810, 29299, 27927, 28162, 29875, 28696, 27154, 29303, 26239, 27587, 27796, 25560, 27943, 25499,
            25548, 26869, 29616, 29819, 28552, 25345, 26517, 27280, 29217, 28631, 27795, 26931, 29536, 29482, 25047, 29126,
            29713, 26127, 26189, 29016, 27925, 26578, 29720, 29057, 29791, 28379, 25016, 25117, 26801, 27929, 27085, 26603,
            26989, 29719, 25937, 26048, 26198, 28635, 25580, 26324, 27080, 27036, 28656, 29715, 27463, 25729, 29385, 28660,
            28746, 27778, 29283, 28438, 27524, 28043, 29018, 25433, 26282, 29711, 27135, 25044, 26395, 25656, 29487, 28502,
            27745, 27878, 27967, 25432, 29746, 26940, 29861, 27240, 29589, 27213, 28150, 27485, 25815, 26010, 29743, 27267,
            27445, 25077, 29535, 29134, 27197, 27864, 26832, 29744, 26778, 29019, 28576, 25066, 28918, 29355, 26436, 29954,
             29363, 27204, 29809, 25989, 26337, 27736, 26843, 25320, 26794, 28999, 29946, 28206, 26277, 29770, 26381, 26155,
             26120, 27437, 28806, 29030, 26305, 26266, 28888, 28384, 25600, 26612, 25128, 28134, 25297, 26122, 26810, 25248,
             25246, 28291, 25598, 29971, 28698, 28319, 29195, 27282, 29390, 28098, 26978, 26861, 25544, 26092, 29142, 28568,
             25967, 26598, 29404, 28195, 26927, 28108, 27969, 27480, 29913, 25897, 29853, 29587, 25507, 29736, 26132, 25097,
             28362, 28816, 25318, 27784, 29495, 26938, 29295, 25657, 25755, 28313, 26516, 28146, 28659, 28939, 28009, 26299,
             28430, 28108, 28959, 27662, 28856, 26459, 25716, 26051, 25715, 26969, 27427, 26207, 25264, 27009, 29348, 29037,
             28293, 25449, 29548, 25682, 29116, 27642, 27461, 29933, 28799, 26977, 25776, 26375, 27126, 25614, 27858, 26414,
             26634, 28033, 28470, 29757, 25558, 26230, 26783, 27089, 25931, 25578, 29434, 26288, 29616, 25438, 29904, 27982,
             29231, 28727, 28345, 25595, 27040, 26870, 26688, 26261, 26438, 27105, 29542, 25125, 25504, 29879, 27876, 25609,
             29673, 25428, 29683, 28027, 26514, 26006, 25155, 25583, 25494, 25236, 28129, 29016, 25112, 29187, 27633, 26321,
             26718, 26688, 28921, 28166, 28885, 28483, 26899, 25505, 29192, 27648, 28806, 26515, 28162, 27944, 26668, 25517,
             28005, 26823, 25425, 27753, 28386, 29001, 27228, 27393, 26889, 27477, 26024, 29418, 26568, 28414, 29378, 26237,
             27247, 27522, 27439, 28917, 25128, 28274, 25604, 27741, 26476, 26928, 27063, 27371, 29470, 25519, 25879, 27073,
             27878, 29903, 26261, 26460, 26677, 28412, 26069, 27245, 27360, 26436, 27884, 28359, 29696, 26198, 27584, 26221,
             25277, 28502, 26153, 25039, 26192, 27762, 29567, 26392, 27079, 27131, 26593, 29932, 25809, 29215, 29711, 25717,
             27353, 27775, 29316, 26539, 28866, 26838, 28764, 29971, 28951, 27365, 26870, 26185, 26052, 28736, 25647, 25370,
             25896, 26733, 27877, 28686, 25376, 26289, 26683, 25741, 29546, 27328, 28359, 27280, 28027, 29443, 27164, 27194,
             29034, 25443, 26212, 29084, 25284, 26273, 26741, 25890, 29214, 29783, 29533, 27769, 28831, 26706, 25028, 29328,
             29235, 29829, 26814, 29181, 26630, 29991, 27557, 29558, 29171, 29728, 27261, 27215, 26466, 28454, 29631, 27114,
             27706, 26803, 28461, 29645, 26158, 25104, 27777, 27003, 27292, 25936, 29566, 28918, 27688, 27573, 26635, 25639,
             26591, 29010, 25935, 27518, 28421, 27065, 25203, 25105, 27467, 27177, 29955, 27614, 25351, 26577, 28134, 27689,
             25510, 29021, 28517, 27122, 29832, 25526, 26264, 29168, 27878, 26214, 25037, 28548, 26535, 28676, 29012, 29521,
             25816, 26949, 27427, 28851, 29043, 29868, 27364, 29640, 25145, 28293, 29176, 25126, 27139, 29224, 27593, 29291,
             28692, 25794, 28040, 26709, 26158, 27195, 25285, 27501, 26145, 27942, 29758, 29734, 29355, 29319, 29718, 25377,
             26963, 29750, 28057, 26421, 26018, 26559, 26789, 29365, 28550, 27710, 25076, 29960, 29813, 27505, 27435, 28094,
             28858, 28332, 28770, 26033, 28365, 29034, 28236, 26272, 28619, 26767, 29603, 25199, 28265, 29023, 25845, 25937,
             28889, 28943, 29967, 26860, 28270, 26616, 29659, 25338, 25927, 27249, 29603, 26582, 27704, 28289, 25390, 28704,
             27754, 28324, 28409, 25531, 27831, 26301, 29653, 28636, 26863, 26958, 25709, 29313, 25088, 29044, 26873, 29393,
             27625, 27433, 27983, 29564, 29862, 28733, 26683, 28698]

        neg_train_index = list(set(x) ^ set(neg_val_index))
        pos_train_index = list(set(y) ^ set(pos_val_index))


        train_index = neg_train_index
        train_index.extend(pos_train_index)

        val_index = neg_val_index
        val_index.extend(pos_val_index)

        return train_index, val_index




class IMBALANCECIFAR100(IMBALANCECIFAR10):
    """`CIFAR100 <https://www.cs.toronto.edu/~kriz/cifar.html>`_ Dataset.
    This is a subclass of the `CIFAR10` Dataset.
    """
    base_folder = 'cifar-100-python'
    url = "https://www.cs.toronto.edu/~kriz/cifar-100-python.tar.gz"
    filename = "cifar-100-python.tar.gz"
    tgz_md5 = 'eb9058c3a382ffc7106e4002c42a8d85'
    train_list = [
        ['train', '16019d7e3df5f24257cddd939b257f8d'],
    ]

    test_list = [
        ['test', 'f0ef6b0ae62326f3e7ffdfab6717acfc'],
    ]
    meta = {
        'filename': 'meta',
        'key': 'fine_label_names',
        'md5': '7973b15100ade9c7d40fb424638fde48',
    }
    cls_num = 100

    def __init__(self, root, imb_type='step', imb_factor=0.02, rand_number=0, train=True,
             transform=None, target_transform=None,
             download=False, val=False):
        IMBALANCECIFAR10.__init__(self, root, imb_type= imb_type , imb_factor= imb_factor, rand_number=rand_number, train=train,
                              transform=transform, target_transform=target_transform,
                              download=download, val=val)


# root,
# transform=None,
# target_transform=None,
# loader=<function default_loader>,
# is_valid_file = None
#

class TINYIMAGENET(torchvision.datasets.ImageFolder):
    cls_num = 200

    def __init__(self, root, imb_type='exp', imb_factor=0.02, rand_number=0,
                 transform=None, target_transform=None, is_valid_file=None):
        super(TINYIMAGENET, self).__init__(root, transform, target_transform, is_valid_file)
        np.random.seed(rand_number)
        img_num_list = self.get_img_num_per_cls(self.cls_num, imb_type, imb_factor)
        self.gen_imbalanced_data(img_num_list)

        # print("ImageFolder:", self.imgs[0:100])

    def get_img_num_per_cls(self, cls_num, imb_type, imb_factor):
        img_max = len(self.imgs) / cls_num
        img_num_per_cls = []
        if imb_type == 'exp':
            for cls_idx in range(cls_num):
                num = img_max * (imb_factor ** (cls_idx / (cls_num - 1.0)))
                img_num_per_cls.append(int(num))
        elif imb_type == 'step':
            for cls_idx in range(cls_num // 2):
                img_num_per_cls.append(int(img_max))
            for cls_idx in range(cls_num // 2):
                img_num_per_cls.append(int(img_max * imb_factor))
        else:
            img_num_per_cls.extend([int(img_max)] * cls_num)
        return img_num_per_cls

    def gen_imbalanced_data(self, img_num_per_cls):
        new_data = []
        new_targets = []

        # print("img_num_per_cls:", img_num_per_cls)
        # self.data = np.array([x[0] for x in self.imgs])
        self.targets = [x[1] for x in self.imgs]
        self.imgs = np.array(self.imgs)
        # print(self.data[0:10])
        targets_np = np.array(self.targets, dtype=np.int64)
        classes = np.unique(targets_np)
        # np.random.shuffle(classes)
        self.num_per_cls_dict = dict()
        for the_class, the_img_num in zip(classes, img_num_per_cls):
            self.num_per_cls_dict[the_class] = the_img_num
            idx = np.where(targets_np == the_class)[0]
            np.random.shuffle(idx)
            selec_idx = idx[:the_img_num]
            new_data.extend(self.imgs[selec_idx, ...])
            new_targets.extend([the_class, ] * the_img_num)

        self.samples = new_data
        self.targets = new_targets

    def get_cls_num_list(self):
        cls_num_list = []
        for i in range(self.cls_num):
            cls_num_list.append(self.num_per_cls_dict[i])
        return cls_num_list

    def __getitem__(self, index):
        """
        Args:
            index (int): Index

        Returns:
            tuple: (sample, target) where target is class_index of the target class.
        """

        path, target = self.samples[index]
        target = int(target)
        assert os.path.isfile(path) == True, "File not exists"
        img = Image.open(path)
        sample = img.convert('RGB')

        if self.transform is not None:
            sample = self.transform(sample)
        if self.target_transform is not None:
            target = self.target_transform(target)

        return sample, target


if __name__ == '__main__':
    transform = transforms.Compose(
        [transforms.ToTensor(),
         transforms.Normalize((0.5, 0.5, 0.5), (0.5, 0.5, 0.5))])
    trainset = IMBALANCECIFAR100(root='./data', train=True,
                                 download=True, transform=transform)
    trainloader = iter(trainset)
    data, label = next(trainloader)
    import pdb;

    pdb.set_trace()

